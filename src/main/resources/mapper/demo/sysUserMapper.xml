<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2025. Tobe Wang
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.zhaofd.demomybatisweb.demo.repository.SysUserRepository">
    <!-- cache -->
<!--    <cache eviction="LRU" />-->

    <!-- cache-ref -->
<!--    <cache-ref namespace="com.afant.demo.sys.mapper.SysMapper"/>-->

    <!-- resultMap -->
<!--    <resultMap id="mapSysUser" type="SysUser">-->
<!--        <id property="id" column="ID" />-->
<!--        <result property="name" column="NAME" />-->
<!--        <result property="sex" column="SEX" />-->
<!--        <collection property="listSysAddress" ofType="SysAddress" javaType="ArrayList" column="id" select="com.afant.demo.sys.mapper.SysAddressMapper.selectByUserid" />-->
<!--    </resultMap>-->

    <!-- sql -->
    <sql id="columns">
        id, name, sex, regtime
    </sql>

    <!-- insert -->
    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        insert into sys_user(name, sex, regtime) values(#{name}, #{sex}, #{regtime})
    </insert>

    <insert id="saveAll" useGeneratedKeys="true" keyProperty="id">
        insert into sys_user(name, sex, regtime) values
        <foreach item="item" collection="list" separator=",">
            (#{item.name}, #{item.sex}, #{item.regtime})
        </foreach>
    </insert>

    <!-- delete -->
<!--    <delete id="deleteById">-->
<!--        delete from SYS_USER where ID = #{id}-->
<!--    </delete>-->

    <!-- update -->
<!--    <update id="update">-->
<!--        update SYS_USER set NAME = #{name}, SEX = #{sex} where ID = #{id}-->
<!--    </update>-->

    <!-- select -->
    <select id="findById" resultType="sysUser">
        select
            <include refid="columns" />
        from sys_user where id = #{id}
    </select>

    <select id="find" resultType="sysUser">
        <if test="name_LIKE != null">
            <bind name="nameLike" value="'%' + name_LIKE + '%'"/>
        </if>

        select
            <include refid="columns" />
        from sys_user
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <choose>
                <when test="name != null">
                    and name = #{name}
                </when>
                <when test="nameLike != null">
                    and name like #{nameLike}
                </when>
            </choose>
            <if test="sex != null">
                and sex = #{sex}
            </if>
        </where>
        <if test="ORDER_BY != null">
            order by ${ORDER_BY}
        </if>
    </select>

    <select id="findPage" resultType="sysUser">
        <if test="name_LIKE != null">
            <bind name="nameLike" value="'%' + name_LIKE + '%'"/>
        </if>

        select
        <include refid="columns" />
        from sys_user
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <choose>
                <when test="name != null">
                    and name = #{name}
                </when>
                <when test="nameLike != null">
                    and name like #{nameLike}
                </when>
            </choose>
            <if test="sex != null">
                and sex = #{sex}
            </if>
        </where>
        <if test="ORDER_BY != null">
            order by ${ORDER_BY}
        </if>
        limit #{PAGE_OFFSET}, #{PAGE_SIZE}
    </select>

    <select id="count" resultType="long">
        <if test="name_LIKE != null">
            <bind name="nameLike" value="'%' + name_LIKE + '%'"/>
        </if>

        select count(1) from sys_user
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <choose>
                <when test="name != null">
                    and name = #{name}
                </when>
                <when test="nameLike != null">
                    and name like #{nameLike}
                </when>
            </choose>
            <if test="sex != null">
                and sex = #{sex}
            </if>
        </where>
    </select>

    <!-- procedure -->
<!--    <select id="procGetSysUser" resultMap="mapSysUser" useCache="false" statementType="CALLABLE">-->
<!--        {call PROC_GET_SYS_USER(#{name,mode=IN,javaType=String,jdbcType=VARCHAR})}-->
<!--    </select>-->

    <!-- function -->

</mapper>
